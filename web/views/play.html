<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ .Title }}</title>
    {{ template "styling" . }}
  </head>

  <body>
    {{ template "navbar" . }}
    <div class="p-1 sm:p-2 md:p-4 md:mx-8 lg:p-8 lg:mx-52">
      <div class="mb-2 flex justify-center">
        <div class="btn-group">
          <button id="aspect-16-9" class="btn btn-sm" onclick="setAspectRatio('16/9')">16:9</button>
          <button id="aspect-4-3" class="btn btn-sm" onclick="setAspectRatio('4/3')">4:3</button>
          <button id="aspect-auto" class="btn btn-sm" onclick="setAspectRatio('auto')">Auto</button>
        </div>
      </div>
      <div
        id="player"
        class="relative overflow-hidden w-full rounded-xl bg-black"
        style="aspect-ratio: 16/9; min-height: 200px;"
      >
        <iframe
          id="playerIframe"
          class="absolute top-0 left-0 bottom-0 right-0 w-full h-full"
          src="{{ .player_url }}"
          width="100%"
          height="100%"
          webkitAllowFullScreen
          mozallowfullscreen
          allowfullscreen
          allow="autoplay"
        ></iframe>
      </div>
      <script>
        function setAspectRatio(ratio) {
          const playerContainer = document.getElementById('player');
          const buttons = document.querySelectorAll('.btn-group .btn');
          
          // Remove active class from all buttons
          buttons.forEach(btn => btn.classList.remove('btn-active'));
          
          if (ratio === 'auto') {
            // Auto mode: remove fixed aspect ratio, let content determine size
            playerContainer.style.aspectRatio = 'unset';
            playerContainer.style.height = 'auto';
            playerContainer.style.minHeight = '200px';
            document.getElementById('aspect-auto').classList.add('btn-active');
          } else {
            playerContainer.style.aspectRatio = ratio;
            playerContainer.style.height = 'auto';
            if (ratio === '16/9') {
              document.getElementById('aspect-16-9').classList.add('btn-active');
            } else if (ratio === '4/3') {
              document.getElementById('aspect-4-3').classList.add('btn-active');
            }
          }
          
          // Save preference in localStorage
          localStorage.setItem('preferredAspectRatio', ratio);
        }
        
        // Initialize with saved preference or default to 16:9
        document.addEventListener('DOMContentLoaded', function() {
          const savedRatio = localStorage.getItem('preferredAspectRatio') || '16/9';
          setAspectRatio(savedRatio);
          
          // Check URL parameter for aspect ratio override
          const urlParams = new URLSearchParams(window.location.search);
          const aspectParam = urlParams.get('aspect');
          if (aspectParam && ['16/9', '4/3', 'auto'].includes(aspectParam)) {
            setAspectRatio(aspectParam);
          }
        });
      </script>
    </div>
    <div id="epg_parent" class="p-1 sm:p-2 md:p-4 md:mx-8 lg:p-8 lg:mx-52">
      <h2 class="mt-4 sm:mt-0 mb-2 text-lg sm:text-xl font-bold text-center sm:text-left">Now Playing</h2>
      <div id="epg" class="w-full">
        <div class="card w-full sm:w-96 bg-base-200 shadow-xl">
          <figure><img id="episodePoster" alt="Episode Poster" /></figure>
          <div class="card-body">
            <h2 id="showname" class="card-title">
            </h2>
            <div class="flex flex-row gap-2 items-center justify-between">
              <div class="badge badge-error badge-outline">Live</div>
              <div>
                <span>Ends in </span>
                <span id="countdown_hour" class="countdown">
                  <span id="e_hour" style="--value:0;"></span>h
                </span>
                <span id="countdown_minute" class="countdown">
                  <span id="e_minute" style="--value:0;"></span>m
                </span>
                <span id="countdown_second" class="countdown">
                  <span id="e_second" style="--value:0;"></span>s
                </span>
              </div>
            </div>
            <p id="description"></p>
            <div id="keywords" class="card-actions justify-end">
              <div class="hidden badge badge-outline"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="/static/common.js"></script>
    <script src="/static/epg.js"></script>
    {{ template "footer" . }}
  </body>
</html>
