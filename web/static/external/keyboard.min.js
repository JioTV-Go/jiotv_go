!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e="undefined"!=typeof globalThis?globalThis:e||self).flowplayer=e.flowplayer||{},e.flowplayer.keyboard=t())}(this,(function(){"use strict";function e(e,t,n){const r=function(e){return Array.isArray(e)?e.slice(0):e.split(".")}(t);for(;r.length;){if(null==e)return n;const t=r.shift();if("string"!=typeof t)return n;e=e[t]}return null==e?n:e}var t={TAB:"Tab",ENTER:"Enter",ESCAPE:"Escape",SPACE:" ",ARROW_LEFT:"ArrowLeft",ARROW_UP:"ArrowUp",ARROW_RIGHT:"ArrowRight",ARROW_DOWN:"ArrowDown",F:"f",H:"h",J:"j",K:"k",L:"l",M:"m"};function n(){Array.from(document.querySelectorAll(".fp-engine")).forEach(e=>{var t;const n=e.root.querySelector("details[open].fp-menu-container");n&&(n.open=!1,null===(t=n.querySelector("summary"))||void 0===t||t.removeAttribute("aria-expanded"),e.root.classList.toggle("has-menu-opened",!1))})}document.addEventListener("click",(function(e){this.active_menu&&!e.composedPath().includes(this.active_menu)&&(n(),this.active_menu=void 0)}));let r=void 0;function o(e){e.setState("is-kb-active",!0),clearTimeout(r),r=setTimeout((function(){e.setState("is-kb-active",!1)}),2500)}function i(e,t){e.enqueueSeek(t)&&o(e)}const u="flowplayer-ad-ui";let a=void 0;const s=[t.ARROW_UP,t.ARROW_RIGHT,t.ARROW_LEFT,t.ARROW_DOWN],l=[t.SPACE,t.F,t.ESCAPE,t.M,t.ARROW_UP,t.ARROW_DOWN,t.ARROW_RIGHT,t.ARROW_LEFT,t.H,t.J,t.K,t.L];function c(e,t){e.volume=function(e,t,n=0){return Math.max(Math.min(t,e),n)}(e.volume+t,1,0),o(e)}function f(e){e.preventDefault(),e.stopPropagation()}function d(r){var o,a;const d=r.key,R=p(),A=document.activeElement;if(!A)return;if(d===t.TAB){if(!R)return;if(R.setState("is-hovered",!0),R.setState("is-accessibility",!0),!function(e){var t,n;return!(!e.hasState("ad-paused")&&!e.hasState("ad-playing")||!(null===(n=null===(t=null==e?void 0:e.ads)||void 0===t?void 0:t.adapter)||void 0===n?void 0:n.isLinearAd()))}(R)||y(A,u))return;const e=R.root.querySelector(u);if(!e)return;if(R.hasState("ad-playing"))return null===(o=e.querySelector(".fp-small-pause"))||void 0===o?void 0:o.focus();if(R.hasState("ad-paused"))return null===(a=e.querySelector(".fp-small-play"))||void 0===a?void 0:a.focus()}if((d===t.SPACE||d===t.ENTER)&&A.hasAttribute("tabindex")&&(y(A,".flowplayer")||y(A,"flowplayer-playlist-controls"))){const e=y(A,".fp-menu")||!y(A,".fp-menu-container")?A:m(A,".fp-menu-container");return null==e||e.dispatchEvent(new MouseEvent("click",{bubbles:!0})),f(r)}if((d===t.ARROW_DOWN||d===t.ARROW_UP||d===t.ESCAPE)&&(y(A,".fp-menu-container")||y(A,"flowplayer-playlist-controls"))){if(d===t.ARROW_DOWN&&A.nextSibling)return A.nextSibling.focus();if(d===t.ARROW_UP&&A.previousSibling)return A.previousSibling.focus();if(d===t.ESCAPE)return n()}if(!R)return;let v=e(R,"opts.keyboard.seek_step",5);if(v<1&&(v=Math.round(v*R.duration)),~s.indexOf(d)&&A.hasAttribute("aria-valuenow")){const e=~[t.ARROW_UP,t.ARROW_RIGHT].indexOf(d);if(A.matches(".fp-volume"))return c(R,e?.15:-.15),f(r);if(A.matches(".fp-timeline"))return i(R,e?v:-1*v),f(r)}if(!1===function(e,t){return!(t.altKey||t.shiftKey||t.metaKey||t.ctrlKey)&&(!!(e&&e.hasState("is-in-viewport")&&e.started)&&(!!e.root&&void 0))}(R,r))return;const E=!R.hasState("no-timeline");switch(~l.indexOf(d)&&r.preventDefault(),d){case t.SPACE:return R.togglePlay();case t.F:return R.toggleFullScreen();case t.ESCAPE:return R.hasState("is-fullscreen")?R.toggleFullScreen(!1):(null==A||A.blur(),R.setState("is-hovered",!1),R.setState("is-accessibility",!1));case t.M:return R.toggleMute();case t.ARROW_UP:case t.K:return c(R,.15);case t.ARROW_DOWN:case t.J:return c(R,-.15);case t.ARROW_RIGHT:case t.L:return E&&i(R,v);case t.ARROW_LEFT:case t.H:return E&&i(R,-1*v)}}function R(e){setTimeout((function(){e.defaultPrevented||d(e)}),0)}function p(){return A().find(e=>function(e){let t=document.activeElement;for(;t;){if(t===e)return!0;t=t.parentElement}return!1}(e.root))||A().find(e=>document.activeElement===document.body&&e.root.hasFocus)}function A(){return Array.from(document.querySelectorAll(".fp-engine"))}function y(e,t){return!!m(e,t)}function m(e,t){return e.closest(t)}document.addEventListener("keydown",(function(e){if(e.key===t.TAB)return R(e);if(a=p(),a)return function(e,n){const r=document.activeElement;if(e.key===t.F&&n.root.classList.contains("no-fullscreen"))return;if([t.SPACE,t.ARROW_DOWN,t.ARROW_UP,t.ARROW_RIGHT,t.ARROW_LEFT].includes(e.key)||r&&y(r,".fp-menu-container")&&e.key===t.ENTER)return e.preventDefault(),d(e);R(e)}(e,a);const n=document.activeElement;[t.SPACE,t.ENTER,t.ARROW_DOWN,t.ARROW_UP,t.ARROW_RIGHT,t.ARROW_LEFT].includes(e.key)&&n&&y(n,"flowplayer-playlist-controls")&&(e.preventDefault(),d(e))})),document.addEventListener("click",(function(e){const t=e.composedPath();A().forEach(e=>{e.root.hasFocus=t.includes(e.root)})}));class Keyboard{init(e,t,n){}}return function(e,t){if("object"==typeof exports&&"undefined"!=typeof module)return t;if(null===document.currentScript)return t;"flowplayer"in e||(e.flowplayer={extensions:[]});const n=e.flowplayer;"function"==typeof n?n(t):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(t)||n.extensions.push(t))}(window,Keyboard),Keyboard}));
